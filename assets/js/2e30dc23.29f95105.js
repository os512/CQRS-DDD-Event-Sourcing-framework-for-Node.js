"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3961],{5318:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>u});var r=t(7378);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),s=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},m=function(e){var n=s(e.components);return r.createElement(l.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,m=d(e,["components","mdxType","originalType","parentName"]),p=s(t),u=a,h=p["".concat(l,".").concat(u)]||p[u]||c[u]||o;return t?r.createElement(h,i(i({ref:n},m),{},{components:t})):r.createElement(h,i({ref:n},m))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=p;var d={};for(var l in n)hasOwnProperty.call(n,l)&&(d[l]=n[l]);d.originalType=e,d.mdxType="string"==typeof e?e:a,i[1]=d;for(var s=2;s<o;s++)i[s]=t[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},5262:(e,n,t)=>{t.r(n),t.d(n,{frontMatter:()=>d,contentTitle:()=>l,metadata:()=>s,toc:()=>m,default:()=>p});var r=t(2685),a=t(1244),o=(t(7378),t(5318)),i=["components"],d={id:"middleware",title:"Middleware",description:"This topic describes how to use middleware in aggregates, read model resolvers, and projections."},l=void 0,s={unversionedId:"middleware",id:"middleware",isDocsHomePage:!1,title:"Middleware",description:"This topic describes how to use middleware in aggregates, read model resolvers, and projections.",source:"@site/../docs/middleware.md",sourceDirName:".",slug:"/middleware",permalink:"/resolve/docs/middleware",tags:[],version:"current",frontMatter:{id:"middleware",title:"Middleware",description:"This topic describes how to use middleware in aggregates, read model resolvers, and projections."},sidebar:"docs",previous:{title:"API Handlers",permalink:"/resolve/docs/api-handlers"},next:{title:"Frontend",permalink:"/resolve/docs/frontend"}},m=[{value:"General Information",id:"general-information",children:[{value:"Example",id:"example",children:[],level:3}],level:2}],c={toc:m};function p(e){var n=e.components,t=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"general-information"},"General Information"),(0,o.kt)("p",null,"The reSolve framework implements the middleware mechanism that you can use to add intermediate logic to the lifecycle of command handlers as well as read model resolvers and projections."),(0,o.kt)("p",null,"Middleware is defined as a curried function of the following format:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// Takes *next* and returns a handler function\nconst myMiddleware = (next) =>\n  // The handler function's signature depends on the middleware type\n  (middlewareContext, state, command, context) => { // Command middleware handler\n    ...\n    // Regardless of the middleware type, a handler should either call **next** at the end\n    // to continue the processing chain or throw an error\n    return next(middlewareContext, state, command, context)\n  }\n  // (middlewareContext, store, event, context) => { ... } // Projection middleware handler\n  // (middlewareContext, store, params, context) => { ... } // Resolver middleware handler\n")),(0,o.kt)("p",null,"In a middleware handler, you can modify one or more of the handler's parameters and pass their changed versions to the ",(0,o.kt)("inlineCode",{parentName:"p"},"next")," function so they propagate down the processing chain. For example, you can modify the ",(0,o.kt)("inlineCode",{parentName:"p"},"command")," object, add auxiliary data to the ",(0,o.kt)("inlineCode",{parentName:"p"},"context")," object, and so on. You can also intercept and modify data returned back through the chain."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Keep in mind that poorly implemented middleware can brake an application because middleware intercepts the internal request and event processing chains, and can potentially disrupt them."))),(0,o.kt)("p",null,"For details on the API used to implement different types of middleware, refer to the following sections of the ",(0,o.kt)("a",{parentName:"p",href:"/resolve/docs/api/middleware"},"middleware API reference"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/resolve/docs/api/middleware#command-middleware"},"Command Middleware")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/resolve/docs/api/middleware#read-model-projection-middleware"},"Read Model Projection Middleware")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/resolve/docs/api/middleware#read-model-resolver-middleware"},"Read Model Resolver Middleware"))),(0,o.kt)("p",null,"The implemented middleware should be registered in the application's configuration file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// config.app.js\nconst appConfig = {\n  ...\n  middlewares: {\n    aggregate: [\n      'common/middlewares/command-middleware-1.js', // Middlewares are invoked in the order that they are defined in the config\n      'common/middlewares/command-middleware-2.js',\n      'common/middlewares/command-middleware-3.js'\n    ],\n    readModel: {\n        projection: ['common/middlewares/projection-middleware.js'],\n        resolver: ['common/middlewares/resolver-middleware.js']\n    }\n  },\n  ...\n}\n")),(0,o.kt)("h3",{id:"example"},"Example"),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reimagined/resolve/tree/dev/examples/ts/personal-data"},"Personal Data")," example application uses middleware to implement user authorization."))}p.isMDXComponent=!0}}]);