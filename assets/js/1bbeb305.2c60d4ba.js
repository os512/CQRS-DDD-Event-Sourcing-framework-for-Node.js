"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8641],{1687:(e,t,n)=>{n.r(t),n.d(t,{frontMatter:()=>i,contentTitle:()=>c,metadata:()=>p,toc:()=>d,default:()=>s});var r=n(2685),a=n(1244),o=(n(7378),n(5318)),l=["components"],i={id:"factory-function",title:"Factory Function"},c="Encryption Factory Function",p={unversionedId:"api/encryption/factory-function",id:"api/encryption/factory-function",title:"Factory Function",description:"Overview",source:"@site/../docs/api/encryption/factory-function.md",sourceDirName:"api/encryption",slug:"/api/encryption/factory-function",permalink:"/resolve/docs/api/encryption/factory-function",tags:[],version:"current",frontMatter:{id:"factory-function",title:"Factory Function"},sidebar:"docs",previous:{title:"ReSolve Context",permalink:"/resolve/docs/api/api-handler/resolve-context"},next:{title:"Secrets Manager",permalink:"/resolve/docs/api/encryption/secrets-manager"}},d=[{value:"Overview",id:"overview",children:[],level:2},{value:"Aggregate Encryption",id:"aggregate-encryption",children:[],level:2},{value:"Read Model Encryption",id:"read-model-encryption",children:[],level:2},{value:"Related Types",id:"related-types",children:[{value:"Aggregate Encryption Context",id:"aggregate-encryption-context",children:[],level:3},{value:"Event Handler Encryption Context",id:"event-handler-encryption-context",children:[],level:3}],level:2},{value:"See Also",id:"see-also",children:[],level:2}],u={toc:d};function s(e){var t=e.components,n=(0,a.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"encryption-factory-function"},"Encryption Factory Function"),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"To implement aggregate or read model encryption, you need to define an encryption factory function. This function receives data about the currently processed operation and returns an object that contains your implementation of ",(0,o.kt)("inlineCode",{parentName:"p"},"encrypt")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"decrypt")," functions."),(0,o.kt)("h2",{id:"aggregate-encryption"},"Aggregate Encryption"),(0,o.kt)("p",null,"An aggregate encryption function has the following structure:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// common/aggregates/encryption.js\nconst createEncryption = (aggregateId, context) => {\n  ...\n  // Returns an object that contains 'encrypt' and 'decrypt' functions\n  return {\n    encrypt: (data) => ..., // A function that takes data and returns its encrypted version\n    decrypt: (blob) => ..., // A function that takes an encrypted blob and returns unencrypted data\n  }\n}\nexport default createEncryption\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Arguments")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Type"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"aggregateId")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"string")),(0,o.kt)("td",{parentName:"tr",align:null},"The aggregate ID associated with the current operation.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"context")),(0,o.kt)("td",{parentName:"tr",align:null},"An ",(0,o.kt)("a",{parentName:"td",href:"#aggregate-encryption-context"},"aggregate encryption context")," object"),(0,o.kt)("td",{parentName:"tr",align:null},"Contains data and API related to the current operation.")))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Result")),(0,o.kt)("p",null,"The returned value should be an object of the following structure:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"{\n  encrypt: (data) => ..., // A function that takes data and returns its encrypted version\n  decrypt: (blob) => ..., // A function that takes an encrypted blob and returns unencrypted data\n}\n")),(0,o.kt)("h2",{id:"read-model-encryption"},"Read Model Encryption"),(0,o.kt)("p",null,"A read model encryption function has the following structure:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// common/read-models/encryption.js\nconst createEncryption = (event, context) => {\n  ...\n  // Returns an object that contains 'encrypt' and 'decrypt' functions\n  return {\n    encrypt: (data) => ..., // A function that takes data and returns its encrypted version\n    decrypt: (blob) => ..., // A function that takes an encrypted blob and returns unencrypted data\n  }\n}\nexport default createEncryption\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Arguments")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Type"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"event")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("a",{parentName:"td",href:"/resolve/docs/api/event"},"event")),(0,o.kt)("td",{parentName:"tr",align:null},"The currently processed event.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"context")),(0,o.kt)("td",{parentName:"tr",align:null},"An ",(0,o.kt)("a",{parentName:"td",href:"#event-handler-encryption-context"},"event handler encryption context")," object"),(0,o.kt)("td",{parentName:"tr",align:null},"Contains data and API related to the current operation.")))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Result")),(0,o.kt)("p",null,"The returned value should be an object of the following structure:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"{\n  encrypt: (data) => ..., // A function that takes data and returns its encrypted version\n  decrypt: (blob) => ..., // A function that takes an encrypted blob and returns unencrypted data\n}\n")),(0,o.kt)("h2",{id:"related-types"},"Related Types"),(0,o.kt)("h3",{id:"aggregate-encryption-context"},"Aggregate Encryption Context"),(0,o.kt)("p",null,"The aggregate encryption context object has the following fields:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Type"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"jwt?")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"string")),(0,o.kt)("td",{parentName:"tr",align:null},"A JSON Web Token attached to the current request.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"secretsManager")),(0,o.kt)("td",{parentName:"tr",align:null},"A ",(0,o.kt)("a",{parentName:"td",href:"/resolve/docs/api/encryption/secrets-manager"},"secrets manager")," object"),(0,o.kt)("td",{parentName:"tr",align:null},"Exposes API used to store cryptographic secrets in the event store.")))),(0,o.kt)("h3",{id:"event-handler-encryption-context"},"Event Handler Encryption Context"),(0,o.kt)("p",null,"The event handler encryption context object has the following fields:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Type"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"secretsManager")),(0,o.kt)("td",{parentName:"tr",align:null},"A ",(0,o.kt)("a",{parentName:"td",href:"/resolve/docs/api/encryption/secrets-manager"},"secrets manager")," object"),(0,o.kt)("td",{parentName:"tr",align:null},"Exposes API used to store cryptographic secrets in the event store.")))),(0,o.kt)("h2",{id:"see-also"},"See Also"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/resolve/docs/encryption"},"Encryption")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/resolve/docs/api/encryption/secrets-manager"},"Secrets Manager"))))}s.isMDXComponent=!0},5318:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>y});var r=n(7378);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),p=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=p(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},s=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),s=p(n),y=a,m=s["".concat(c,".").concat(y)]||s[y]||u[y]||o;return n?r.createElement(m,l(l({ref:t},d),{},{components:n})):r.createElement(m,l({ref:t},d))}));function y(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=s;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var p=2;p<o;p++)l[p]=n[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}s.displayName="MDXCreateElement"}}]);